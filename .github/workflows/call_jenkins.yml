name: on pr

on:
  pull_request:
    types: [opened, reopened, synchronize]

jobs:
  call-jenkins:
    runs-on: ubuntu-latest
    steps:
      - name: Trigger Jenkins Job
        run: |
          # Jenkins credentials
          JENKINS_USER="Vignesh"
          JENKINS_TOKEN="1121201e9007d7026bf01877253aec6a13"
          JENKINS_URL="http://13.60.66.220:8080/"
          JOB_NAME="GitClone"
          JOB_TOKEN="mytoken123"

          # Step 1: Get CSRF crumb dynamically
          CRUMB_JSON=$(curl -s -u $JENKINS_USER:$JENKINS_TOKEN "$JENKINS_URL/crumbIssuer/api/json")
          CRUMB=$(echo $CRUMB_JSON | jq -r '.crumb')
          CRUMB_FIELD=$(echo $CRUMB_JSON | jq -r '.crumbRequestField')

          # Step 2: Trigger Jenkins job with crumb and token
          curl -u $JENKINS_USER:$JENKINS_TOKEN \
            -H "$CRUMB_FIELD: $CRUMB" \
            -X POST "$JENKINS_URL/job/$JOB_NAME/build?token=$JOB_TOKEN"
